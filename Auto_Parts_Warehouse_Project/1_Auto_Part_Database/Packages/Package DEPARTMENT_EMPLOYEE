create or replace PACKAGE PACKAGE_DEPARTMENT_EMPLOYEE
AS
    PROCEDURE UPDATE_EMPLOYEE_CURRENT_DATE;
    PROCEDURE CHANGE_EMPLOYEE_DEPARTMENT(EMP_ID INT, NEW_DEPT INT);
    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT);
    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT, START_DATE DATE);
    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT, START_DATE DATE, CURRENT_DATE DATE);
END PACKAGE_DEPARTMENT_EMPLOYEE;

create or replace PACKAGE BODY PACKAGE_DEPARTMENT_EMPLOYEE
AS
    PROCEDURE UPDATE_EMPLOYEE_CURRENT_DATE
    IS
    BEGIN
    UPDATE DEPARTMENT_EMPLOYEE
    SET TO_DATE = SYSDATE
    WHERE ACTIVE = 'Y';
    END;

    PROCEDURE CHANGE_EMPLOYEE_DEPARTMENT(EMP_ID INT, NEW_DEPT INT)
    IS
    BEGIN

    UPDATE DEPARTMENT_EMPLOYEE
    SET ACTIVE = 'N'
    WHERE EMPLOYEE_ID = EMP_ID AND ACTIVE = 'Y';

    INSERT INTO DEPARTMENT_EMPLOYEE(EMPLOYEE_ID, DEPARTMENT_ID)
    VALUES(EMP_ID, NEW_DEPT);
    END;

    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT)
    IS
    is_active NUMBER;
    BEGIN
    is_active := CHECK_ACTIVE_DEPARTMENT_EMPLOYEE(EMP_ID);
    IF is_active = 0 THEN 
        INSERT INTO DEPARTMENT_EMPLOYEE(EMPLOYEE_ID, DEPARTMENT_ID)
        VALUES(EMP_ID, DEPT_ID);
    ELSE
        dbms_output.put_line ('Employee: ' || TO_CHAR(EMP_ID) || ' is already working for a department');
    END IF;
    END;

    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT, START_DATE DATE)
    IS
    is_active NUMBER;
    BEGIN
    is_active := CHECK_ACTIVE_DEPARTMENT_EMPLOYEE(EMP_ID);
    IF is_active = 0 THEN 
        INSERT INTO DEPARTMENT_EMPLOYEE(EMPLOYEE_ID, DEPARTMENT_ID, FROM_DATE)
        VALUES(EMP_ID, DEPT_ID, START_DATE);
    ELSE
        dbms_output.put_line ('Employee: ' || TO_CHAR(EMP_ID) || ' is already working for a department');
    END IF;
    END;

    PROCEDURE ADD_DEPARTMENT_EMPLOYEE(EMP_ID INT, DEPT_ID INT, START_DATE DATE, CURRENT_DATE DATE)
    IS
    is_active NUMBER;
    BEGIN
    is_active := CHECK_ACTIVE_DEPARTMENT_EMPLOYEE(EMP_ID);
    IF is_active = 0 THEN 
        INSERT INTO DEPARTMENT_EMPLOYEE(EMPLOYEE_ID, DEPARTMENT_ID, FROM_DATE, TO_DATE)
        VALUES(EMP_ID, DEPT_ID,START_DATE, CURRENT_DATE);
    ELSE
        dbms_output.put_line ('Employee: ' || TO_CHAR(EMP_ID) || ' is already working for a department');
    END IF;
    END;

END;
