/*
* Table used for reference
*/ 
CREATE TABLE ORDER_LIST_AUDIT(
    EMPLOYEE_ID INT,
    USER_NAME VARCHAR2(255),
    ORDER_ID INT,
    OPERATION VARCHAR2(50),
    PRODUCT_ID INT,
    UNITS INT,
    OLD_BIN VARCHAR2(255),
    OLD_ZONE VARCHAR2(255),
    NEW_BIN VARCHAR(255),
    NEW_ZONE VARCHAR2(255),
    DATE_CHANGE DATE
)


/*
* This will keep track who moved parts around the warehouse
*/

CREATE OR REPLACE TRIGGER UPDATE_ORDER_LIST_AUDIT
AFTER INSERT OR UPDATE OF ZONE
ON ORDER_LIST
FOR EACH ROW
BEGIN
    IF INSERTING THEN
    INSERT INTO ORDER_LIST_AUDIT(EMPLOYEE_ID, USER_NAME, ORDER_ID, OPERATION, PRODUCT_ID, UNITS, OLD_BIN, OLD_ZONE, NEW_BIN, NEW_ZONE, DATE_CHANGE)
    VALUES(NULL, NULL, :new.ORDER_ID, 'Part Picked', :new.PRODUCT_ID, :new.units, NULL, NULL, :new.BIN, :new.ZONE, sysdate);    
    END IF;

    IF UPDATING THEN
    INSERT INTO ORDER_LIST_AUDIT(EMPLOYEE_ID, USER_NAME, ORDER_ID, OPERATION, PRODUCT_ID, UNITS, OLD_BIN, OLD_ZONE, NEW_BIN, NEW_ZONE, DATE_CHANGE)
    VALUES(PACKAGE_EMPLOYEE_LOGIN.GET_USER_ID(USER), USER, :new.ORDER_ID, 'Part Moved', :new.PRODUCT_ID, :new.units, :old.BIN, :old.ZONE, :new.BIN, :new.ZONE, sysdate);    
    END IF;
END;
